@page "/AddPackage"
@inject IPackageHandler pacHandler
@inject NavigationManager navman

<header style="text-align:center">Add Package</header>

<TestingWithBlazor.Shared.Form.PackageForm ButtonText="Add" Check_Handle="@check_add"  OnValidSubmit="@ValidSubmit"/>

@code {

	bool loading = false;

	bool check_add(ErrorMessageHandler errorMessage, Package new_package){
		if (string.IsNullOrWhiteSpace(new_package.Address.Street))
		{
			errorMessage.ShowMessage("Street can not be empty");
			return false;
		}
		if (string.IsNullOrWhiteSpace(new_package.Address.City))
		{
			errorMessage.ShowMessage("City can not be empty");
			return false;
		}
		if (string.IsNullOrWhiteSpace(new_package.Address.State))
		{
			errorMessage.ShowMessage("State can not be empty");
			return false;
		}
		if (new_package.TrackingID == 0)
		{
			errorMessage.ShowMessage("Tracking Id can not be 0");
			return false;
		}
		if (new_package.Address.Zipcode.ToString().Count() != 5)
		{
			errorMessage.ShowMessage("ZipCode must be 5 digits");
			return false;
		}
		foreach (var b in pacHandler.GetPackages())
		{
			if (b.TrackingID == new_package.TrackingID)
			{
				errorMessage.ShowMessage("Tracking ID must be unique");
				return false;
			}
		}
		return true;
	}

	void ValidSubmit(Package var){
		pacHandler.AddPackage(var);
		navman.NavigateTo("/MainApp");
	}
}
